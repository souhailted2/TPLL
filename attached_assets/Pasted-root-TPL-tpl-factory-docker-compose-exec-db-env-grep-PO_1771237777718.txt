root@TPL:~/tpl-factory# docker compose exec db env | grep POSTGRES
POSTGRES_USER=tpl_user
POSTGRES_PASSWORD=changeme_strong_password
POSTGRES_DB=tpl_factory
root@TPL:~/tpl-factory# docker compose logs app | head -30
app-1  | Firebase Admin initialized successfully
app-1  | Alert checker started - checking every 60 minutes
app-1  | /app/dist/index.cjs:74
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?
app-1  | Node.js v20.20.0
app-1  | Firebase Admin initialized successfully
app-1  | Alert checker started - checking every 60 minutes
app-1  | /app/dist/index.cjs:74
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | Alert checker started - checking every 60 minutes
app-1  | /app/dist/index.cjs:74
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | Alert checker started - checking every 60 minutes
app-1  | /app/dist/index.cjs:74
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | Alert checker started - checking every 60 minutes
app-1  | /app/dist/index.cjs:74
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | Alert checker started - checking every 60 minutes
app-1  | /app/dist/index.cjs:74
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?
app-1  | Node.js v20.20.0
app-1  | Firebase Admin initialized successfully
app-1  | Alert checker started - checking every 60 minutes
app-1  | /app/dist/index.cjs:74
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | Alert checker started - checking every 60 minutes
app-1  | /app/dist/index.cjs:74
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()},gf=class extends Qt{static[v]="PgTimestampStringBuilder";constructor(e,r,n){super(e,"string","PgTimestampString"),this.config.withTimezone=r,this.config.precision=n}build(e){return new bs(e,this.config)}},bs=class extends E{static[v]="PgTimestampString";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function lt(t,e={}){let{name:r,config:n}=X(t,e);return n?.mode==="string"?new gf(r,n.withTimezone??!1,n.precision):new hf(r,n?.withTimezone??!1,n?.precision)}var vf=class extends j{static[v]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(y`gen_random_uuid()`)}build(e){return new ws(e,this.config)}},ws=class extends E{static[v]="PgUUID";getSQLType(){return"uuid"}};function _S(t){return new vf(t??"")}var yf=class extends j{static[v]="PgVarcharBuilder";constructor(e,r){super(e,"string","PgVarchar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new xf(e,this.config)}},xf=class extends E{static[v]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function He(t,e={}){let{name:r,config:n}=X(t,e);return new yf(r,n)}var bf=class extends j{static[v]="PgBinaryVectorBuilder";constructor(e,r){super(e,"string","PgBinaryVector"),this.config.dimensions=r.dimensions}build(e){return new wf(e,this.config)}},wf=class extends E{static[v]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}};function ES(t,e){let{name:r,config:n}=X(t,e);return new bf(r,n)}var Sf=class extends j{static[v]="PgHalfVectorBuilder";constructor(e,r){super(e,"array","PgHalfVector"),this.config.dimensions=r.dimensions}build(e){return new Cf(e,this.config)}},Cf=class extends E{static[v]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(r=>Number.parseFloat(r))}};function TS(t,e){let{name:r,config:n}=X(t,e);return new Sf(r,n)}var _f=class extends j{static[v]="PgSparseVectorBuilder";constructor(e,r){super(e,"string","PgSparseVector"),this.config.dimensions=r.dimensions}build(e){return new Ef(e,this.config)}},Ef=class extends E{static[v]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function kS(t,e){let{name:r,config:n}=X(t,e);return new _f(r,n)}var Tf=class extends j{static[v]="PgVectorBuilder";constructor(e,r){super(e,"array","PgVector"),this.config.dimensions=r.dimensions}build(e){return new kf(e,this.config)}},kf=class extends E{static[v]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(r=>Number.parseFloat(r))}};function AS(t,e){let{name:r,config:n}=X(t,e);return new Tf(r,n)}function PS(){return{bigint:nS,bigserial:iS,boolean:ds,char:sS,cidr:aS,customType:oS,date:cS,doublePrecision:uS,inet:lS,integer:Vt,interval:pS,json:dS,jsonb:Fo,line:fS,macaddr:mS,macaddr8:hS,numeric:gS,point:vS,geometry:xS,real:bS,serial:_r,smallint:wS,smallserial:SS,text:ke,time:CS,timestamp:lt,uuid:_S,varchar:He,bit:ES,halfvec:TS,sparsevec:kS,vector:AS}}var Af=Symbol.for("drizzle:PgInlineForeignKeys"),IS=Symbol.for("drizzle:EnableRLS"),Me=class extends A{static[v]="PgTable";static Symbol=Object.assign({},A.Symbol,{InlineForeignKeys:Af,EnableRLS:IS});[Af]=[];[IS]=!1;[A.Symbol.ExtraConfigBuilder]=void 0};function UO(t,e,r,n,i=t){let s=new Me(t,n,i),a=typeof e=="function"?e(PS()):e,o=Object.fromEntries(Object.entries(a).map(([c,p])=>{let d=p;d.setName(c);let f=d.build(s);return s[Af].push(...d.buildForeignKeys(f,s)),[c,f]})),l=Object.fromEntries(Object.entries(a).map(([c,p])=>{let d=p;d.setName(c);let f=d.buildExtraConfigColumn(s);return[c,f]})),u=Object.assign(s,o);return u[A.Symbol.Columns]=o,u[A.Symbol.ExtraConfigColumns]=l,r&&(u[Me.Symbol.ExtraConfigBuilder]=r),Object.assign(u,{enableRLS:()=>(u[Me.Symbol.EnableRLS]=!0,u)})}var Ht=(t,e,r)=>UO(t,e,r,void 0);var qo=class{static[v]="PgPrimaryKeyBuilder";columns;name;constructor(e,r){this.columns=e,this.name=r}build(e){return new Pf(e,this.columns,this.name)}},Pf=class{constructor(e,r,n){this.table=e,this.columns=r,this.name=n}static[v]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[Me.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};function pt(t,e){return Gw(e)&&!cd(t)&&!w(t,ut)&&!w(t,sr)&&!w(t,te)&&!w(t,A)&&!w(t,Xe)?new ut(t,e):t}var $=(t,e)=>y`${t} = ${pt(e,t)}`,OS=(t,e)=>y`${t} <> ${pt(e,t)}`;function cr(...t){let e=t.filter(r=>r!==void 0);if(e.length!==0)return e.length===1?new I(e):new I([new Te("("),y.join(e,new Te(" and ")),new Te(")")])}function Ss(...t){let e=t.filter(r=>r!==void 0);if(e.length!==0)return e.length===1?new I(e):new I([new Te("("),y.join(e,new Te(" or ")),new Te(")")])}function NS(t){return y`not ${t}`}var jS=(t,e)=>y`${t} > ${pt(e,t)}`,FS=(t,e)=>y`${t} >= ${pt(e,t)}`,qS=(t,e)=>y`${t} < ${pt(e,t)}`,RS=(t,e)=>y`${t} <= ${pt(e,t)}`;function ri(t,e){return Array.isArray(e)?e.length===0?y`false`:y`${t} in ${e.map(r=>pt(r,t))}`:y`${t} in ${pt(e,t)}`}function DS(t,e){return Array.isArray(e)?e.length===0?y`true`:y`${t} not in ${e.map(r=>pt(r,t))}`:y`${t} not in ${pt(e,t)}`}function $S(t){return y`${t} is null`}function MS(t){return y`${t} is not null`}function LS(t){return y`exists ${t}`}function BS(t){return y`not exists ${t}`}function zS(t,e,r){return y`${t} between ${pt(e,t)} and ${pt(r,t)}`}function US(t,e,r){return y`${t} not between ${pt(e,t)} and ${pt(r,t)}`}function QS(t,e){return y`${t} like ${e}`}function VS(t,e){return y`${t} not like ${e}`}function Cs(t,e){return y`${t} ilike ${e}`}function HS(t,e){return y`${t} not ilike ${e}`}function GS(t){return y`${t} asc`}function _s(t){return y`${t} desc`}var Ro=class{constructor(e,r,n){this.sourceTable=e,this.referencedTable=r,this.relationName=n,this.referencedTableName=r[A.Symbol.Name]}static[v]="Relation";referencedTableName;fieldName},Do=class{constructor(e,r){this.table=e,this.config=r}static[v]="Relations"},Er=class t extends Ro{constructor(e,r,n,i){super(e,r,n?.relationName),this.config=n,this.isNullable=i}static[v]="One";withFieldName(e){let r=new t(this.sourceTable,this.referencedTable,this.config,this.isNullable);return r.fieldName=e,r}},Es=class t extends Ro{constructor(e,r,n){super(e,r,n?.relationName),this.config=n}static[v]="Many";withFieldName(e){let r=new t(this.sourceTable,this.referencedTable,this.config);return r.fieldName=e,r}};function KS(){return{and:cr,between:zS,eq:$,exists:LS,gt:jS,gte:FS,ilike:Cs,inArray:ri,isNull:$S,isNotNull:MS,like:QS,lt:qS,lte:RS,ne:OS,not:NS,notBetween:US,notExists:BS,notLike:VS,notIlike:HS,notInArray:DS,or:Ss,sql:y}}function ZS(){return{sql:y,asc:GS,desc:_s}}function WS(t,e){Object.keys(t).length===1&&"default"in t&&!w(t.default,A)&&(t=t.default);let r={},n={},i={};for(let[s,a]of Object.entries(t))if(w(a,A)){let o=Hr(a),l=n[o];r[o]=s,i[s]={tsName:s,dbName:a[A.Symbol.Name],schema:a[A.Symbol.Schema],columns:a[A.Symbol.Columns],relations:l?.relations??{},primaryKey:l?.primaryKey??[]};for(let c of Object.values(a[A.Symbol.Columns]))c.primary&&i[s].primaryKey.push(c);let u=a[A.Symbol.ExtraConfigBuilder]?.(a[A.Symbol.ExtraConfigColumns]);if(u)for(let c of Object.values(u))w(c,qo)&&i[s].primaryKey.push(...c.columns)}else if(w(a,Do)){let o=Hr(a.table),l=r[o],u=a.config(e(a.table)),c;for(let[p,d]of Object.entries(u))if(l){let f=i[l];f.relations[p]=d,c&&f.primaryKey.push(...c)}else o in n||(n[o]={relations:{},primaryKey:c}),n[o].relations[p]=d}return{tables:i,tableNamesMap:r}}function Zr(t,e){return new Do(t,r=>Object.fromEntries(Object.entries(e(r)).map(([n,i])=>[n,i.withFieldName(n)])))}function QO(t){return function(r,n){return new Er(t,r,n,n?.fields.reduce((i,s)=>i&&s.notNull,!0)??!1)}}function VO(t){return function(r,n){return new Es(t,r,n)}}function JS(t,e,r){if(w(r,Er)&&r.config)return{fields:r.config.fields,references:r.config.references};let n=e[Hr(r.referencedTable)];if(!n)throw new Error(`Table "${r.referencedTable[A.Symbol.Name]}" not found in schema`);let i=t[n];if(!i)throw new Error(`Table "${n}" not found in schema`);let s=r.sourceTable,a=e[Hr(s)];if(!a)throw new Error(`Table "${s[A.Symbol.Name]}" not found in schema`);let o=[];for(let l of Object.values(i.relations))(r.relationName&&r!==l&&l.relationName===r.relationName||!r.relationName&&l.referencedTable===r.sourceTable)&&o.push(l);if(o.length>1)throw r.relationName?new Error(`There are multiple relations with name "${r.relationName}" in table "${n}"`):new Error(`There are multiple relations between "${n}" and "${r.sourceTable[A.Symbol.Name]}". Please specify relation name`);if(o[0]&&w(o[0],Er)&&o[0].config)return{fields:o[0].config.references,references:o[0].config.fields};throw new Error(`There is not enough information to infer relation "${a}.${r.fieldName}"`)}function XS(t){return{one:QO(t),many:VO(t)}}function $o(t,e,r,n,i=s=>s){let s={};for(let[a,o]of n.entries())if(o.isJson){let l=e.relations[o.tsKey],u=r[a],c=typeof u=="string"?JSON.parse(u):u;s[o.tsKey]=w(l,Er)?c&&$o(t,t[o.relationTableTsKey],c,o.selection,i):c.map(p=>$o(t,t[o.relationTableTsKey],p,o.selection,i))}else{let l=i(r[a]),u=o.field,c;w(u,te)?c=u:w(u,I)?c=u.decoder:c=u.sql.decoder,s[o.tsKey]=l===null?null:c.mapFromDriverValue(l)}return s}var ni=class extends Xe{static[v]="PgViewBase"};var Tr=class{static[v]="PgDialect";casing;constructor(e){this.casing=new No(e?.casing)}async migrate(e,r,n){let i=typeof n=="string"?"__drizzle_migrations":n.migrationsTable??"__drizzle_migrations",s=typeof n=="string"?"drizzle":n.migrationsSchema??"drizzle",a=y`
app-1  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
root@TPL:~/tpl-factory#   docker compose exec app env | grep DATABASE
Error response from daemon: Container 287395ac1ffef1f642e7919719dd220b7b1152c3d5411fe7efe2fff9660571af is restarting, wait until the container is running
root@TPL:~/tpl-factory# docker compose exec db psql -U tpl_user -d tpl_factory -c "ALTER USER tpl_user PASSWORD 'changeme_strong_password';"
ALTER ROLE
root@TPL:~/tpl-factory# docker compose restart app
[+] restart 0/1
  Container tpl-factory-app-1 Restarting                                                                           0.3s
root@TPL:~/tpl-factory# docker compose logs app --tail 10
app-1  | Inserted batch 5/10
app-1  | Inserted batch 6/10
app-1  | Inserted batch 7/10
app-1  | Inserted batch 8/10
app-1  | Inserted batch 9/10
app-1  | Inserted batch 10/10
app-1  | Added 4738 new products to database.
app-1  | 10:05:27 AM [express] GET /api/notifications 401 in 22ms :: {"message":"Unauthorized"}
app-1  | 10:05:28 AM [express] GET /api/notifications 401 in 4ms :: {"message":"Unauthorized"}
app-1  | 10:05:37 AM [express] POST /api/orders 401 in 2ms :: {"message":"Unauthorized"}
root@TPL:~/tpl-factory# docker compose ps
NAME                  IMAGE                COMMAND                  SERVICE   CREATED          STATUS                    PORTS
tpl-factory-app-1     tpl-factory-app      "docker-entrypoint.s"   app       24 minutes ago   Up 19 minutes             0.0.0.0:5000->5000/tcp, [::]:5000->5000/tcp
tpl-factory-db-1      postgres:16-alpine   "docker-entrypoint.s"   db        24 minutes ago   Up 24 minutes (healthy)   5432/tcp
tpl-factory-nginx-1   nginx:alpine         "/docker-entrypoint."   nginx     24 minutes ago   Up 24 minutes             0.0.0.0:80->80/tcp, [::]:80->80/tcp, 0.0.0.0:443->443/tcp, [::]:443->443/tcp
root@TPL:~/tpl-factory# docker compose logs app | grep -i firebase
app-1  | Firebase Admin initialized successfully
app-1  | Firebase Admin initialized successfully
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | Firebase Admin initialized successfully
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | Firebase Admin initialized successfully
app-1  | Firebase Admin initialized successfully
app-1  | Firebase Admin initialized successfully
app-1  | Firebase Admin initialized successfully
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
app-1  | `);is.write(lw.format.apply(lw,e))}}Object.defineProperty(ir.exports,"isWin",{get:function(){return yo},set:function(t){yo=t}});ir.exports.warnTo=function(t){var e=is;return is=t,e};ir.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(yo?uw.join(e.APPDATA||"./","postgresql","pgpass.conf"):uw.join(e.HOME||"./",".pgpass"));return r};ir.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yo?!0:(e=e||"<unkn>",oO(t.mode)?t.mode&(nO|iO)?(Mp('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Mp('WARNING: password file "%s" is not a plain file',e),!1))};var uO=ir.exports.match=function(t,e){return Wn.slice(0,-1).reduce(function(r,n,i){return i==1&&Number(t[n]||rO)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};ir.exports.getPassword=function(t,e,r){var n,i=e.pipe(tO());function s(l){var u=lO(l);u&&pO(u)&&uO(t,u)&&(n=u[cO],i.end())}var a=function(){e.destroy(),r(n)},o=function(l){e.destroy(),Mp("WARNING: error on reading file: %s",l),r(void 0)};e.on("error",o),i.on("data",s).on("end",a).on("error",o)};var lO=ir.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,i=0,s=0,a={},o=!1,l=function(c,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Wn[c]]=f},u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),o=n==$p-1,o){l(n,i);break}u>=0&&e==":"&&r!=="\\"&&(l(n,i,u+1),i=u+2,n+=1)}return a=Object.keys(a).length===$p?a:null,a},pO=ir.exports.isValidEntry=function(t){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},r=0;r<Wn.length;r+=1){var n=e[r],i=t[Wn[r]]||"",s=n(i);if(!s)return!1}return!0}});var fw=x((sD,Lp)=>{"use strict";var iD=require("path"),dw=require("fs"),xo=pw();Lp.exports=function(t,e){var r=xo.getFileName();dw.stat(r,function(n,i){if(n||!xo.usePgPass(i,r))return e(void 0);var s=dw.createReadStream(r);xo.getPassword(t,s,e)})};Lp.exports.warnTo=xo.warnTo});var vw=x((aD,gw)=>{"use strict";var dO=require("events").EventEmitter,mw=Vn(),Bp=F1(),fO=lo(),mO=up(),hw=G1(),hO=rs(),gO=Dp(),vO=ap(),bo=class extends dO{constructor(e){super(),this.connectionParameters=new mO(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let r=e||{};this._Promise=r.Promise||global.Promise,this._types=new fO(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!r.enableChannelBinding,this.connection=r.connection||new gO({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||hO.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){let r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(i=>{i?n(i):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{fw()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vO.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bp.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await Bp.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{Bp.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let r=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(r);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return mw.escapeIdentifier(e)}escapeLiteral(e){return mw.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){let i,s,a,o,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,s=i=e,typeof r=="function"&&(i.callback=i.callback||r)):(a=e.query_timeout||this.connectionParameters.query_timeout,i=new hw(e,r,n),i.callback||(s=new this._Promise((u,c)=>{i.callback=(p,d)=>p?c(p):u(d)}).catch(u=>{throw Error.captureStackTrace(u),u}))),a&&(l=i.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let c=this.queryQueue.indexOf(i);c>-1&&this.queryQueue.splice(c,1),this._pulseQueryQueue()},a),i.callback=(u,c)=>{clearTimeout(o),l(u,c)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),s):(this.queryQueue.push(i),this._pulseQueryQueue(),s):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),s)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};bo.Query=hw;gw.exports=bo});var ww=x((oD,bw)=>{"use strict";var yO=require("events").EventEmitter,yw=function(){},xw=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},zp=class{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}},Jn=class{constructor(e){this.callback=e}};function xO(){throw new Error("Release called on client which has already been released to the pool.")}function wo(t,e){if(e)return{callback:e,result:void 0};let r,n,i=function(a,o){a?r(a):n(o)},s=new t(function(a,o){n=a,r=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:s}}function bO(t,e){return function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)}}var Up=class extends yO{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||So().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let i=r.idleListener;return this._acquireClient(n,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,r){let n=xw(this._idle,s=>s.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(s=>s!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof r=="function"&&r()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let r=wo(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Jn(r.callback)),n;let i=(o,l,u)=>{clearTimeout(a),r.callback(o,l,u)},s=new Jn(i),a=setTimeout(()=>{xw(this._pendingQueue,o=>o.callback===i),s.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(s),n}return this.newClient(new Jn(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=bO(this,r);this.log("checking client timeout");let i,s=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),s=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(a=>{if(i&&clearTimeout(i),r.on("error",n),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==r),s&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,yw);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Jn((u,c,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),r.once("end",()=>clearTimeout(o))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,s=>{if(s)return e.release(s),r.callback(s,void 0,yw);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return i=>{n&&xO(),n=!0,this._release(e,r,i)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let s;this.options.idleTimeoutMillis&&this._isAboveMin()&&(s=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&s.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new zp(e,r,s)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let s=wo(this.Promise,e);return setImmediate(function(){return s.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),s.result}typeof r=="function"&&(n=r,r=void 0);let i=wo(this.Promise,n);return n=i.callback,this.connect((s,a)=>{if(s)return n(s);let o=!1,l=u=>{o||(o=!0,a.release(u),n(u))};a.once("error",l),this.log("dispatching query");try{a.query(e,r,(u,c)=>{if(this.log("query dispatched"),a.removeListener("error",l),!o)return o=!0,a.release(u),u?n(u):n(void 0,c)})}catch(u){return a.release(u),n(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=wo(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};bw.exports=Up});var _w=x((cD,Cw)=>{"use strict";var Sw=require("events").EventEmitter,wO=require("util"),Qp=Vn(),Xn=Cw.exports=function(t,e,r){Sw.call(this),t=Qp.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.queryMode=t.queryMode,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wO.inherits(Xn,Sw);var SO={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Xn.prototype.handleError=function(t){let e=this.native.pq.resultErrorFields();if(e)for(let r in e){let n=SO[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};Xn.prototype.then=function(t,e){return this._getPromise().then(t,e)};Xn.prototype.catch=function(t){return this._getPromise().catch(t)};Xn.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};Xn.prototype.submit=function(t){this.state="running";let e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;let r=function(n,i,s){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(s.length>1?i.forEach((a,o)=>{a.forEach(l=>{e.emit("row",l,s[o])})}):i.forEach(function(a){e.emit("row",a,s)})),e.state="end",e.emit("end",s),e.callback&&e.callback(null,s)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Qp.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}let n=this.values.map(Qp.prepareValue);t.native.query(this.text,n,r)}else this.queryMode==="extended"?t.native.query(this.text,[],r):t.native.query(this.text,r)}});var Pw=x((uD,Aw)=>{"use strict";var Ew;try{Ew=require("pg-native")}catch(t){throw t}var CO=lo(),Tw=require("events").EventEmitter,_O=require("util"),EO=up(),kw=_w(),ot=Aw.exports=function(t){Tw.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new CO(t.types),this.native=new Ew({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new EO(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ot.Query=kw;_O.inherits(ot,Tw);ot.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ot.prototype._connect=function(t){let e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(i){if(i)return e.native.end(),t(i);e._connected=!0,e.native.on("error",function(s){e._queryable=!1,e._errorAllQueries(s),e.emit("error",s)}),e.native.on("notification",function(s){e.emit("notification",{channel:s.relname,payload:s.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};ot.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};ot.prototype.query=function(t,e,r){let n,i,s,a,o;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")s=t.query_timeout||this.connectionParameters.query_timeout,i=n=t,typeof e=="function"&&(t.callback=e);else if(s=t.query_timeout||this.connectionParameters.query_timeout,n=new kw(t,e,r),!n.callback){let l,u;i=new this._Promise((c,p)=>{l=c,u=p}).catch(c=>{throw Error.captureStackTrace(c),c}),n.callback=(c,p)=>c?u(c):l(p)}return s&&(o=n.callback,a=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{n.handleError(l,this.connection)}),o(l),n.callback=()=>{};let u=this._queryQueue.indexOf(n);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},s),n.callback=(l,u)=>{clearTimeout(a),o(l,u)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(n),this._pulseQueryQueue(),i):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};ot.prototype.end=function(t){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));let r;return t||(r=new this._Promise(function(n,i){t=s=>s?i(s):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};ot.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ot.prototype._pulseQueryQueue=function(t){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);let r=this;e.once("_done",function(){r._pulseQueryQueue()})};ot.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};ot.prototype.ref=function(){};ot.prototype.unref=function(){};ot.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};ot.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Vp=x((lD,Iw)=>{"use strict";Iw.exports=Pw()});var So=x((dD,ss)=>{"use strict";var TO=vw(),kO=rs(),AO=Dp(),PO=pp(),IO=Vn(),OO=ww(),NO=lo(),{DatabaseError:jO}=Fp(),{escapeIdentifier:FO,escapeLiteral:qO}=Vn(),RO=t=>class extends OO{constructor(r){super(r,t)}},Hp=function(t){this.defaults=kO,this.Client=t,this.Query=this.Client.Query,this.Pool=RO(this.Client),this._pools=[],this.Connection=AO,this.types=ts(),this.DatabaseError=jO,this.TypeOverrides=NO,this.escapeIdentifier=FO,this.escapeLiteral=qO,this.Result=PO,this.utils=IO};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ss.exports=new Hp(Vp()):(ss.exports=new Hp(TO),Object.defineProperty(ss.exports,"native",{configurable:!0,enumerable:!1,get(){let t=null;try{t=new Hp(Vp())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ss.exports,"native",{value:t}),t}}))});var Fw=x((fD,jw)=>{"use strict";var DO=(t,e)=>{e?t.then(r=>process.nextTick(e,null,r),r=>process.nextTick(e,r||new Error("Promise was rejected with falsy value"))):t.catch(()=>{})},Ow=()=>Math.ceil(Date.now()/1e3),Nw=t=>t.replaceAll('"','""');jw.exports=function(e){let r=e.Store||e.session.Store;class n extends r{#l;#p;#o;#i;#c;#e;#t;#u;#s;#a;#r;constructor(s={}){if(super(s),this.#s=s.schemaName?Nw(s.schemaName):void 0,this.#r=s.tableName?Nw(s.tableName):"session",!this.#s&&this.#r.includes('"."')&&(console.warn('DEPRECATION WARNING: Schema should be provided through its dedicated "schemaName" option rather than through "tableName"'),this.#r=this.#r.replace(/^([^"]+)""\.""([^"]+)$/,'$1"."$2')),this.#l=!!s.createTableIfMissing,this.#a=void 0,this.ttl=s.ttl,this.#p=!!s.disableTouch,this.#o=s.errorLog||console.error.bind(console),s.pool!==void 0)this.#e=s.pool,this.#i=!1;else if(s.pgPromise!==void 0){if(typeof s.pgPromise.any!="function")throw new TypeError("`pgPromise` config must point to an existing and configured instance of pg-promise pointing at your database");this.#c=s.pgPromise,this.#i=!1}else{let a=s.conString||process.env.DATABASE_URL,o=s.conObject;o||(o={},a&&(o.connectionString=a)),this.#e=new(So()).Pool(o),this.#e.on("error",l=>{this.#o("PG Pool error:",l)}),this.#i=!0}s.pruneSessionInterval===!1?this.#t=!1:(this.#t=(s.pruneSessionInterval||900)*1e3,s.pruneSessionRandomizedInterval!==!1&&(this.#u=s.pruneSessionRandomizedInterval||(a=>Math.ceil(a/2+a*Math.random()))))}async _rawEnsureSessionStoreTable(){let s=this.quotedTable(),a=await this._asyncQuery("SELECT to_regclass($1::text)",[s],!0);if(a&&a.to_regclass===null){let o=require("node:path"),c=(await require("node:fs").promises.readFile(o.resolve(__dirname,"./table.sql"),"utf8")).replaceAll('"session"',s);await this._asyncQuery(c,[],!0)}}async _ensureSessionStoreTable(s){if(!(s||this.#l===!1))return this.#a||(this.#a=this._rawEnsureSessionStoreTable()),this.#a}async close(){this.closed=!0,this.#d(),this.#i&&this.#e&&await this.#e.end()}#n(){if(this.#t&&!this.closed&&!this.pruneTimer){let s=this.#u?this.#u(this.#t):this.#t;this.pruneTimer=setTimeout(()=>{this.pruneSessions()},s),this.pruneTimer.unref()}}#d(){this.pruneTimer&&(clearTimeout(this.pruneTimer),this.pruneTimer=void 0)}pruneSessions(s){this.query("DELETE FROM "+this.quotedTable()+" WHERE expire < to_timestamp($1)",[Ow()],a=>{if(s&&typeof s=="function")return s(a);a&&this.#o("Failed to prune sessions:",a),this.#d(),this.#n()})}quotedTable(){let s='"'+this.#r+'"';return this.#s&&(s='"'+this.#s+'".'+s),s}#f(s){let a;if(s&&s.cookie&&s.cookie.expires){let o=new Date(s.cookie.expires);a=Math.ceil(o.valueOf()/1e3)}else{let o=this.ttl||86400;a=Math.ceil(Date.now()/1e3+o)}return a}async _asyncQuery(s,a,o){if(await this._ensureSessionStoreTable(o),this.#c){let l=await this.#c.any(s,a);return l&&l[0]?l[0]:void 0}else{if(!this.#e)throw new Error("Pool missing for some reason");let l=await this.#e.query(s,a);return l&&l.rows&&l.rows[0]?l.rows[0]:void 0}}query(s,a,o,l){let u;if(typeof a=="function"){if(o)throw new Error("Two callback functions set at once");o=a,u=[]}else u=a||[];let c=this._asyncQuery(s,u,l);DO(c,o)}get(s,a){this.#n(),this.query("SELECT sess FROM "+this.quotedTable()+" WHERE sid = $1 AND expire >= to_timestamp($2)",[s,Ow()],(o,l)=>{if(o)return a(o);if(!l)return a(null);try{return a(null,typeof l.sess=="string"?JSON.parse(l.sess):l.sess)}catch{return this.destroy(s,a)}})}set(s,a,o){this.#n();let l=this.#f(a),u="INSERT INTO "+this.quotedTable()+" (sess, expire, sid) SELECT $1, to_timestamp($2), $3 ON CONFLICT (sid) DO UPDATE SET sess=$1, expire=to_timestamp($2) RETURNING sid";this.query(u,[a,l,s],c=>{o&&o(c)})}destroy(s,a){this.#n(),this.query("DELETE FROM "+this.quotedTable()+" WHERE sid = $1",[s],o=>{a&&a(o)})}touch(s,a,o){if(this.#n(),this.#p){o&&o(null);return}let l=this.#f(a);this.query("UPDATE "+this.quotedTable()+" SET expire = to_timestamp($1) WHERE sid = $2 RETURNING sid",[l,s],u=>{o&&o(u)})}}return n}});var Fj={};em(Fj,{log:()=>Yf});module.exports=LC(Fj);var ac=mt(Al(),1);var Qf=mt(Ub(),1),vC=mt(Fw(),1),Vf=mt(require("bcryptjs"),1);var vt=mt(So(),1),mD=vt.default.Client,hD=vt.default.Pool,gD=vt.default.Connection,vD=vt.default.types,yD=vt.default.Query,xD=vt.default.DatabaseError,bD=vt.default.escapeIdentifier,wD=vt.default.escapeLiteral,SD=vt.default.Result,CD=vt.default.TypeOverrides,_D=vt.default.defaults,Cr=vt.default;var v=Symbol.for("drizzle:entityKind"),TD=Symbol.for("drizzle:hasOwnEntityKind");function w(t,e){if(!t||typeof t!="object")return!1;if(t instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,v))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(t).constructor;if(r)for(;r;){if(v in r&&r[v]===e[v])return!0;r=Object.getPrototypeOf(r)}return!1}var Gp=class{static[v]="ConsoleLogWriter";write(e){console.log(e)}},Co=class{static[v]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Gp}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},_o=class{static[v]="NoopLogger";logQuery(){}};var Ve=class{static[v]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}then(e,r){return this.execute().then(e,r)}};var te=class{constructor(e,r){this.table=e,this.config=r,this.name=r.name,this.keyAsName=r.keyAsName,this.notNull=r.notNull,this.default=r.default,this.defaultFn=r.defaultFn,this.onUpdateFn=r.onUpdateFn,this.hasDefault=r.hasDefault,this.primary=r.primaryKey,this.isUnique=r.isUnique,this.uniqueName=r.uniqueName,this.uniqueType=r.uniqueType,this.dataType=r.dataType,this.columnType=r.columnType,this.generated=r.generated,this.generatedIdentity=r.generatedIdentity}static[v]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Eo=class{static[v]="ColumnBuilder";config;constructor(e,r,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:r,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var jt=Symbol.for("drizzle:Name");var To=class{static[v]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,r){this.reference=()=>{let{name:n,columns:i,foreignColumns:s}=e();return{name:n,columns:i,foreignTable:s[0].table,foreignColumns:s}},r&&(this._onUpdate=r.onUpdate,this._onDelete=r.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kp(e,this)}},Kp=class{constructor(e,r){this.table=e,this.reference=r.reference,this.onUpdate=r._onUpdate,this.onDelete=r._onDelete}static[v]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:r,foreignColumns:n}=this.reference(),i=r.map(o=>o.name),s=n.map(o=>o.name),a=[this.table[jt],...i,n[0].table[jt],...s];return e??`${a.join("_")}_fk`}};function ko(t,...e){return t(...e)}function Jp(t,e){return`${t[jt]}_${e.join("_")}_unique`}var Zp=class{constructor(e,r){this.name=r,this.columns=e}static[v]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wp(e,this.columns,this.nullsNotDistinctConfig,this.name)}},qw=class{static[v]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Zp(e,this.name)}},Wp=class{constructor(e,r,n,i){this.table=e,this.columns=r,this.name=i??Jp(this.table,this.columns.map(s=>s.name)),this.nullsNotDistinct=n}static[v]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Rw(t,e,r){for(let n=e;n<t.length;n++){let i=t[n];if(i==="\\"){n++;continue}if(i==='"')return[t.slice(e,n).replace(/\\/g,""),n+1];if(!r&&(i===","||i==="}"))return[t.slice(e,n).replace(/\\/g,""),n]}return[t.slice(e).replace(/\\/g,""),t.length]}function Dw(t,e=0){let r=[],n=e,i=!1;for(;n<t.length;){let s=t[n];if(s===","){(i||n===e)&&r.push(""),i=!0,n++;continue}if(i=!1,s==="\\"){n+=2;continue}if(s==='"'){let[l,u]=Rw(t,n+1,!0);r.push(l),n=u;continue}if(s==="}")return[r,n+1];if(s==="{"){let[l,u]=Dw(t,n+1);r.push(l),n=u;continue}let[a,o]=Rw(t,n,!1);r.push(a),n=o}return[r,n]}function $w(t){let[e]=Dw(t,1);return e}function Xp(t){return`{${t.map(e=>Array.isArray(e)?Xp(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var j=class extends Eo{foreignKeyConfigs=[];static[v]="PgColumnBuilder";array(e){return new ed(this.config.name,this,e)}references(e,r={}){return this.foreignKeyConfigs.push({ref:e,actions:r}),this}unique(e,r){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=r?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,r){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>ko((s,a)=>{let o=new To(()=>{let l=s();return{columns:[e],foreignColumns:[l]}});return a.onUpdate&&o.onUpdate(a.onUpdate),a.onDelete&&o.onDelete(a.onDelete),o.build(r)},n,i))}buildExtraConfigColumn(e){return new Yp(e,this.config)}},E=class extends te{constructor(e,r){r.uniqueName||(r.uniqueName=Jp(e,[r.name])),super(e,r),this.table=e}static[v]="PgColumn"},Yp=class extends E{static[v]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},Yn=class{static[v]="IndexedColumn";constructor(e,r,n,i){this.name=e,this.keyAsName=r,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},ed=class extends j{static[v]="PgArrayBuilder";constructor(e,r,n){super(e,"array","PgArray"),this.config.baseBuilder=r,this.config.size=n}build(e){let r=this.config.baseBuilder.build(e);return new td(e,this.config,r)}},td=class t extends E{constructor(e,r,n,i){super(e,r),this.baseColumn=n,this.range=i,this.size=r.size}size;static[v]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=$w(e)),e.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(e,r=!1){let n=e.map(i=>i===null?null:w(this.baseColumn,t)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return r?n:Xp(n)}};var Mw=Symbol.for("drizzle:isPgEnum");function Bw(t){return!!t&&typeof t=="function"&&Mw in t&&t[Mw]===!0}var Lw=class extends j{static[v]="PgEnumColumnBuilder";constructor(e,r){super(e,"string","PgEnumColumn"),this.config.enum=r}build(e){return new rd(e,this.config)}},rd=class extends E{static[v]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,r){super(e,r),this.enum=r.enum}getSQLType(){return this.enum.enumName}};var Ee=class{static[v]="Subquery";constructor(e,r,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:r,alias:n,isWith:i}}},ei=class extends Ee{static[v]="WithSubquery"};var zw="0.39.3";var nd,id,se={startActiveSpan(t,e){return nd?(id||(id=nd.trace.getTracer("drizzle-orm",zw)),ko((r,n)=>n.startActiveSpan(t,i=>{try{return e(i)}catch(s){throw i.setStatus({code:r.SpanStatusCode.ERROR,message:s instanceof Error?s.message:"Unknown error"}),s}finally{i.end()}}),nd,id)):e()}};var ae=Symbol.for("drizzle:ViewBaseConfig");var Ao=Symbol.for("drizzle:Schema"),Po=Symbol.for("drizzle:Columns"),Uw=Symbol.for("drizzle:ExtraConfigColumns"),sd=Symbol.for("drizzle:OriginalName"),ad=Symbol.for("drizzle:BaseName"),as=Symbol.for("drizzle:IsAlias"),Qw=Symbol.for("drizzle:ExtraConfigBuilder"),Vw=Symbol.for("drizzle:IsDrizzleTable"),A=class{static[v]="Table";static Symbol={Name:jt,Schema:Ao,OriginalName:sd,Columns:Po,ExtraConfigColumns:Uw,BaseName:ad,IsAlias:as,ExtraConfigBuilder:Qw};[jt];[sd];[Ao];[Po];[Uw];[ad];[as]=!1;[Vw]=!0;[Qw]=void 0;constructor(e,r,n){this[jt]=this[sd]=e,this[Ao]=r,this[ad]=n}};function od(t){return typeof t=="object"&&t!==null&&Vw in t}function ct(t){return t[jt]}function Hr(t){return`${t[Ao]??"public"}.${t[jt]}`}var Hw=class{static[v]="FakePrimitiveParam"};function cd(t){return t!=null&&typeof t.getSQL=="function"}function $O(t){let e={sql:"",params:[]};for(let r of t)e.sql+=r.sql,e.params.push(...r.params),r.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...r.typings));return e}var Te=class{static[v]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new I([this])}},I=class t{constructor(e){this.queryChunks=e}static[v]="SQL";decoder=Kw;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return se.startActiveSpan("drizzle.buildSQL",r=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return r?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,r){let n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{casing:i,escapeName:s,escapeParam:a,prepareTyping:o,inlineParams:l,paramStartIndex:u}=n;return $O(e.map(c=>{if(w(c,Te))return{sql:c.value.join(""),params:[]};if(w(c,os))return{sql:s(c.value),params:[]};if(c===void 0)return{sql:"",params:[]};if(Array.isArray(c)){let p=[new Te("(")];for(let[d,f]of c.entries())p.push(f),d<c.length-1&&p.push(new Te(", "));return p.push(new Te(")")),this.buildQueryFromSourceParams(p,n)}if(w(c,t))return this.buildQueryFromSourceParams(c.queryChunks,{...n,inlineParams:l||c.shouldInlineParams});if(w(c,A)){let p=c[A.Symbol.Schema],d=c[A.Symbol.Name];return{sql:p===void 0||c[as]?s(d):s(p)+"."+s(d),params:[]}}if(w(c,te)){let p=i.getColumnCasing(c);if(r.invokeSource==="indexes")return{sql:s(p),params:[]};let d=c.table[A.Symbol.Schema];return{sql:c.table[as]||d===void 0?s(c.table[A.Symbol.Name])+"."+s(p):s(d)+"."+s(c.table[A.Symbol.Name])+"."+s(p),params:[]}}if(w(c,Xe)){let p=c[ae].schema,d=c[ae].name;return{sql:p===void 0||c[ae].isAlias?s(d):s(p)+"."+s(d),params:[]}}if(w(c,ut)){if(w(c.value,sr))return{sql:a(u.value++,c),params:[c],typings:["none"]};let p=c.value===null?null:c.encoder.mapToDriverValue(c.value);if(w(p,t))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return o&&(d=[o(c.encoder)]),{sql:a(u.value++,p),params:[p],typings:d}}return w(c,sr)?{sql:a(u.value++,c),params:[c],typings:["none"]}:w(c,t.Aliased)&&c.fieldAlias!==void 0?{sql:s(c.fieldAlias),params:[]}:w(c,Ee)?c._.isWith?{sql:s(c._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),c._.sql,new Te(") "),new os(c._.alias)],n):Bw(c)?c.schema?{sql:s(c.schema)+"."+s(c.enumName),params:[]}:{sql:s(c.enumName),params:[]}:cd(c)?c.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([c.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),c.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(c,n),params:[]}:{sql:a(u.value++,c),params:[c],typings:["none"]}}))}mapInlineParam(e,{escapeString:r}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return r(e);if(typeof e=="object"){let n=e.toString();return r(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new t.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},os=class{constructor(e){this.value=e}static[v]="Name";brand;getSQL(){return new I([this])}};function Gw(t){return typeof t=="object"&&t!==null&&"mapToDriverValue"in t&&typeof t.mapToDriverValue=="function"}var Kw={mapFromDriverValue:t=>t},Zw={mapToDriverValue:t=>t},x7={...Kw,...Zw},ut=class{constructor(e,r=Zw){this.value=e,this.encoder=r}static[v]="Param";brand;getSQL(){return new I([this])}};function y(t,...e){let r=[];(e.length>0||t.length>0&&t[0]!=="")&&r.push(new Te(t[0]));for(let[n,i]of e.entries())r.push(i,new Te(t[n+1]));return new I(r)}(t=>{function e(){return new I([])}t.empty=e;function r(l){return new I(l)}t.fromList=r;function n(l){return new I([new Te(l)])}t.raw=n;function i(l,u){let c=[];for(let[p,d]of l.entries())p>0&&u!==void 0&&c.push(u),c.push(d);return new I(c)}t.join=i;function s(l){return new os(l)}t.identifier=s;function a(l){return new sr(l)}t.placeholder=a;function o(l,u){return new ut(l,u)}t.param=o})(y||(y={}));(t=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[v]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}t.Aliased=e})(I||(I={}));var sr=class{constructor(e){this.name=e}static[v]="Placeholder";getSQL(){return new I([this])}};function ud(t,e){return t.map(r=>{if(w(r,sr)){if(!(r.name in e))throw new Error(`No value for placeholder "${r.name}" was provided`);return e[r.name]}if(w(r,ut)&&w(r.value,sr)){if(!(r.value.name in e))throw new Error(`No value for placeholder "${r.value.name}" was provided`);return r.encoder.mapToDriverValue(e[r.value.name])}return r})}var Ww=Symbol.for("drizzle:IsDrizzleView"),Xe=class{static[v]="View";[ae];[Ww]=!0;constructor({name:e,schema:r,selectedFields:n,query:i}){this[ae]={name:e,originalName:e,schema:r,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new I([this])}};function Jw(t){return typeof t=="object"&&t!==null&&Ww in t}te.prototype.getSQL=function(){return new I([this])};A.prototype.getSQL=function(){return new I([this])};Ee.prototype.getSQL=function(){return new I([this])};var Gr=class{constructor(e){this.table=e}static[v]="ColumnAliasProxyHandler";get(e,r){return r==="table"?this.table:e[r]}},ti=class{constructor(e,r){this.alias=e,this.replaceOriginalName=r}static[v]="TableAliasProxyHandler";get(e,r){if(r===A.Symbol.IsAlias)return!0;if(r===A.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===A.Symbol.OriginalName)return this.alias;if(r===ae)return{...e[ae],name:this.alias,isAlias:!0};if(r===A.Symbol.Columns){let i=e[A.Symbol.Columns];if(!i)return i;let s={};return Object.keys(i).map(a=>{s[a]=new Proxy(i[a],new Gr(new Proxy(e,this)))}),s}let n=e[r];return w(n,te)?new Proxy(n,new Gr(new Proxy(e,this))):n}},Xw=class{constructor(e){this.alias=e}static[v]="RelationTableAliasProxyHandler";get(e,r){return r==="sourceTable"?Kr(e.sourceTable,this.alias):e[r]}};function Kr(t,e){return new Proxy(t,new ti(e,!1))}function Ut(t,e){return new Proxy(t,new Gr(new Proxy(t.table,new ti(e,!1))))}function ld(t,e){return new I.Aliased(cs(t.sql,e),t.fieldAlias)}function cs(t,e){return y.join(t.queryChunks.map(r=>w(r,te)?Ut(r,e):w(r,I)?cs(r,e):w(r,I.Aliased)?ld(r,e):r))}var ye=class t{static[v]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(r===ae)return{...e[ae],selectedFields:new Proxy(e[ae].selectedFields,this)};if(typeof r=="symbol")return e[r];let i=(w(e,Ee)?e._.selectedFields:w(e,Xe)?e[ae].selectedFields:e)[r];if(w(i,I.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let s=i.clone();return s.isSelectionField=!0,s}if(w(i,I)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(i,te)?this.config.alias?new Proxy(i,new Gr(new Proxy(i.table,new ti(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new t(this.config))}};function Yw(t,e,r){let n={},i=t.reduce((s,{path:a,field:o},l)=>{let u;w(o,te)?u=o:w(o,I)?u=o.decoder:u=o.sql.decoder;let c=s;for(let[p,d]of a.entries())if(p<a.length-1)d in c||(c[d]={}),c=c[d];else{let f=e[l],h=c[d]=f===null?null:u.mapFromDriverValue(f);if(r&&w(o,te)&&a.length===2){let m=a[0];m in n?typeof n[m]=="string"&&n[m]!==ct(o.table)&&(n[m]=!1):n[m]=h===null?ct(o.table):!1}}return s},{});if(r&&Object.keys(n).length>0)for(let[s,a]of Object.entries(n))typeof a=="string"&&!r[a]&&(i[s]=null);return i}function kt(t,e){return Object.entries(t).reduce((r,[n,i])=>{if(typeof n!="string")return r;let s=e?[...e,n]:[n];return w(i,te)||w(i,I)||w(i,I.Aliased)?r.push({path:s,field:i}):w(i,A)?r.push(...kt(i[A.Symbol.Columns],s)):r.push(...kt(i,s)),r},[])}function us(t,e){let r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(let[i,s]of r.entries())if(s!==n[i])return!1;return!0}function Io(t,e){let r=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>w(i,I)||w(i,te)?[n,i]:[n,new ut(i,t[A.Symbol.Columns][n])]);if(r.length===0)throw new Error("No values to set");return Object.fromEntries(r)}function eS(t,e){for(let r of e)for(let n of Object.getOwnPropertyNames(r.prototype))n!=="constructor"&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(r.prototype,n)||Object.create(null))}function Oo(t){return t[A.Symbol.Columns]}function tS(t){return t[ae].selectedFields}function ar(t){return w(t,Ee)?t._.alias:w(t,Xe)?t[ae].name:w(t,I)?void 0:t[A.Symbol.IsAlias]?t[A.Symbol.Name]:t[A.Symbol.BaseName]}function X(t,e){return{name:typeof t=="string"&&t.length>0?t:"",config:typeof t=="object"?t:e}}function rS(t){if(typeof t!="object"||t===null||t.constructor.name!=="Object")return!1;if("logger"in t){let e=typeof t.logger;return!(e!=="boolean"&&(e!=="object"||typeof t.logger.logQuery!="function")&&e!=="undefined")}if("schema"in t){let e=typeof t.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in t){let e=typeof t.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in t)return!(t.mode!=="default"||t.mode!=="planetscale"||t.mode!==void 0);if("connection"in t){let e=typeof t.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in t){let e=typeof t.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(t).length===0}var ls=class extends Ve{constructor(e,r,n,i){super(),this.session=r,this.dialect=n,this.config={table:e,withList:i}}static[v]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[A.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=kt(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return se.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>se.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ye({alias:ct(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};function MO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(r=>r.toLowerCase()).join("_")}function LO(t){return(t.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((r,n,i)=>{let s=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return r+s},"")}function BO(t){return t}var No=class{static[v]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?MO:e==="camelCase"?LO:BO}getColumnCasing(e){if(!e.keyAsName)return e.name;let r=e.table[A.Symbol.Schema]??"public",n=e.table[A.Symbol.OriginalName],i=`${r}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let r=e[A.Symbol.Schema]??"public",n=e[A.Symbol.OriginalName],i=`${r}.${n}`;if(!this.cachedTables[i]){for(let s of Object.values(e[A.Symbol.Columns])){let a=`${i}.${s.name}`;this.cache[a]=this.convert(s.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var ps=class extends Error{static[v]="DrizzleError";constructor({message:e,cause:r}){super(e),this.name="DrizzleError",this.cause=r}},jo=class extends ps{static[v]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var or=class extends j{static[v]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:r,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:r,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var pd=class extends or{static[v]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new dd(e,this.config)}},dd=class extends E{static[v]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},fd=class extends or{static[v]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new md(e,this.config)}},md=class extends E{static[v]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function nS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new pd(r):new fd(r)}var hd=class extends j{static[v]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new gd(e,this.config)}},gd=class extends E{static[v]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},vd=class extends j{static[v]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new yd(e,this.config)}},yd=class extends E{static[v]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function iS(t,e){let{name:r,config:n}=X(t,e);return n.mode==="number"?new hd(r):new vd(r)}var xd=class extends j{static[v]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bd(e,this.config)}},bd=class extends E{static[v]="PgBoolean";getSQLType(){return"boolean"}};function ds(t){return new xd(t??"")}var wd=class extends j{static[v]="PgCharBuilder";constructor(e,r){super(e,"string","PgChar"),this.config.length=r.length,this.config.enumValues=r.enum}build(e){return new Sd(e,this.config)}},Sd=class extends E{static[v]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function sS(t,e={}){let{name:r,config:n}=X(t,e);return new wd(r,n)}var Cd=class extends j{static[v]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new _d(e,this.config)}},_d=class extends E{static[v]="PgCidr";getSQLType(){return"cidr"}};function aS(t){return new Cd(t??"")}var Ed=class extends j{static[v]="PgCustomColumnBuilder";constructor(e,r,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=r,this.config.customTypeParams=n}build(e){return new Td(e,this.config)}},Td=class extends E{static[v]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,r){super(e,r),this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function oS(t){return(e,r)=>{let{name:n,config:i}=X(e,r);return new Ed(n,i,t)}}var Qt=class extends j{static[v]="PgDateColumnBaseBuilder";defaultNow(){return this.default(y`now()`)}};var kd=class extends Qt{static[v]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new fs(e,this.config)}},fs=class extends E{static[v]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}},Ad=class extends Qt{static[v]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ms(e,this.config)}},ms=class extends E{static[v]="PgDateString";getSQLType(){return"date"}};function cS(t,e){let{name:r,config:n}=X(t,e);return n?.mode==="date"?new kd(r):new Ad(r)}var Pd=class extends j{static[v]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Id(e,this.config)}},Id=class extends E{static[v]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function uS(t){return new Pd(t??"")}var Od=class extends j{static[v]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new Nd(e,this.config)}},Nd=class extends E{static[v]="PgInet";getSQLType(){return"inet"}};function lS(t){return new Od(t??"")}var jd=class extends or{static[v]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Fd(e,this.config)}},Fd=class extends E{static[v]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function Vt(t){return new jd(t??"")}var qd=class extends j{static[v]="PgIntervalBuilder";constructor(e,r){super(e,"string","PgInterval"),this.config.intervalConfig=r}build(e){return new Rd(e,this.config)}},Rd=class extends E{static[v]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${e}${r}`}};function pS(t,e={}){let{name:r,config:n}=X(t,e);return new qd(r,n)}var Dd=class extends j{static[v]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new hs(e,this.config)}},hs=class extends E{static[v]="PgJson";constructor(e,r){super(e,r)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function dS(t){return new Dd(t??"")}var $d=class extends j{static[v]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new gs(e,this.config)}},gs=class extends E{static[v]="PgJsonb";constructor(e,r){super(e,r)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function Fo(t){return new $d(t??"")}var Md=class extends j{static[v]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ld(e,this.config)}},Ld=class extends E{static[v]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Bd=class extends j{static[v]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new zd(e,this.config)}},zd=class extends E{static[v]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[r,n,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(r),b:Number.parseFloat(n),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function fS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Md(r):new Bd(r)}var Ud=class extends j{static[v]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qd(e,this.config)}},Qd=class extends E{static[v]="PgMacaddr";getSQLType(){return"macaddr"}};function mS(t){return new Ud(t??"")}var Vd=class extends j{static[v]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Hd(e,this.config)}},Hd=class extends E{static[v]="PgMacaddr8";getSQLType(){return"macaddr8"}};function hS(t){return new Vd(t??"")}var Gd=class extends j{static[v]="PgNumericBuilder";constructor(e,r,n){super(e,"string","PgNumeric"),this.config.precision=r,this.config.scale=n}build(e){return new vs(e,this.config)}},vs=class extends E{static[v]="PgNumeric";precision;scale;constructor(e,r){super(e,r),this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function gS(t,e){let{name:r,config:n}=X(t,e);return new Gd(r,n?.precision,n?.scale)}var Kd=class extends j{static[v]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Zd(e,this.config)}},Zd=class extends E{static[v]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return[Number.parseFloat(r),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Wd=class extends j{static[v]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Jd(e,this.config)}},Jd=class extends E{static[v]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[r,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(r),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function vS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Kd(r):new Wd(r)}function zO(t){let e=[];for(let r=0;r<t.length;r+=2)e.push(Number.parseInt(t.slice(r,r+2),16));return new Uint8Array(e)}function yS(t,e){let r=new ArrayBuffer(8),n=new DataView(r);for(let i=0;i<8;i++)n.setUint8(i,t[e+i]);return n.getFloat64(0,!0)}function Xd(t){let e=zO(t),r=0,n=e[r];r+=1;let i=new DataView(e.buffer),s=i.getUint32(r,n===1);r+=4;let a;if(s&536870912&&(a=i.getUint32(r,n===1),r+=4),(s&65535)===1){let o=yS(e,r);r+=8;let l=yS(e,r);return r+=8,[o,l]}throw new Error("Unsupported geometry type")}var Yd=class extends j{static[v]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ef(e,this.config)}},ef=class extends E{static[v]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Xd(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},tf=class extends j{static[v]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new rf(e,this.config)}},rf=class extends E{static[v]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let r=Xd(e);return{x:r[0],y:r[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function xS(t,e){let{name:r,config:n}=X(t,e);return!n?.mode||n.mode==="tuple"?new Yd(r):new tf(r)}var nf=class extends j{static[v]="PgRealBuilder";constructor(e,r){super(e,"number","PgReal"),this.config.length=r}build(e){return new sf(e,this.config)}},sf=class extends E{static[v]="PgReal";constructor(e,r){super(e,r)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function bS(t){return new nf(t??"")}var af=class extends j{static[v]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new of(e,this.config)}},of=class extends E{static[v]="PgSerial";getSQLType(){return"serial"}};function _r(t){return new af(t??"")}var cf=class extends or{static[v]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new uf(e,this.config)}},uf=class extends E{static[v]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function wS(t){return new cf(t??"")}var lf=class extends j{static[v]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new pf(e,this.config)}},pf=class extends E{static[v]="PgSmallSerial";getSQLType(){return"smallserial"}};function SS(t){return new lf(t??"")}var df=class extends j{static[v]="PgTextBuilder";constructor(e,r){super(e,"string","PgText"),this.config.enumValues=r.enum}build(e){return new ff(e,this.config)}},ff=class extends E{static[v]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ke(t,e={}){let{name:r,config:n}=X(t,e);return new df(r,n)}var mf=class extends Qt{constructor(e,r,n){super(e,"string","PgTime"),this.withTimezone=r,this.precision=n,this.config.withTimezone=r,this.config.precision=n}static[v]="PgTimeBuilder";build(e){return new ys(e,this.config)}},ys=class extends E{static[v]="PgTime";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function CS(t,e={}){let{name:r,config:n}=X(t,e);return new mf(r,n.withTimezone??!1,n.precision)}var hf=class extends Qt{static[v]="PgTimestampBuilder";constructor(e,r,n){super(e,"date","PgTimestamp"),this.config.withTimezone=r,this.config.precision=n}build(e){return new xs(e,this.config)}},xs=class extends E{static[v]="PgTimestamp";withTimezone;precision;constructor(e,r){super(e,r),this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?Firebase Admin initialized successfully
root@TPL:~/tpl-factory#